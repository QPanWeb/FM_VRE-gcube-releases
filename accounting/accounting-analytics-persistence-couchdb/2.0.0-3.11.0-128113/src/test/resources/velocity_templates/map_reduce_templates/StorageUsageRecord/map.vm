function(doc) {
	if(doc.usageRecordType == "StorageUsageRecord" || doc.recordType == "StorageUsageRecord"){
		if((doc.operationCount && isNaN(Number(doc.operationCount))) || (doc.dataVolume && isNaN(Number(doc.dataVolume)))){
			emit([0, "Invalid Value", doc.id], doc);
			return;
		}
		var data = {};
		data.dataVolume = doc.dataVolume ? Number(doc.dataVolume) : 0;
		data.operationCount = doc.operationCount ? Number(doc.operationCount) : 1;
		
		var propertiesKey = [];
#foreach( $property in $properties )
		propertiesKey.push(doc.$property);
#end
		
#if( $slice )
		var dataKey = getDataKey(Number(doc.creationTime)).slice(0, $slice);
		var finalKey = dataKey.concat(propertiesKey);
#else
		var dataKey = getDataKey(Number(doc.creationTime));
		var finalKey = propertiesKey.concat(dataKey);
#end

		finalKey.unshift(doc.scope);
		
		emit(finalKey, data);
	}
}

function getDataKey(timestamp){
	var date = new Date(timestamp);
	var key = [];
	key.push(date.getUTCFullYear());
	key.push(date.getUTCMonth()+1);
	key.push(date.getUTCDate());
	key.push(date.getUTCHours());
	key.push(date.getUTCMinutes());
	key.push(date.getUTCSeconds());
	key.push(date.getUTCMilliseconds());
	return key;
}

